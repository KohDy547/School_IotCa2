@page "{targetId}"
@using CA2_Web.Models
@model CA2_Web.Pages.Room.IndexModel
@{
    ViewData["Title"] = Model.Room.Name;
}

<div class="container-fluid row">
    <div class="col-md-6">
        <h2 class="mt-0">@Model.Room.Name</h2>
    </div>
    <div class="col-md-6 text-right">
        <a class="btn btn-outline-info" href="/Room/Book/@Model.Room.Id">Book Timing</a>
        @if (Model.IsAdmin)
        {
            <button type="button" class="btn btn-outline-danger" onclick="btn_Delete_OnClick();">Delete</button>
        }
    </div>
</div>
@if (Model.IsAdmin)
{
    <br />
    <form class="container" method="post">
        <label>Device Id</label>
        <input type="text" style="display:none;" value="updateDeviceId" name="postType" />
        <input type="text" style="display:none;" value="@Model.Room.Id" name="targetRoomId" />
        <div class="row">
            <div class="input-group">
                @if (!string.IsNullOrEmpty(Model.Room.DeviceId))
                {
                    <input id="txt_searchLocation" name="txt_DeviceId" type="text" class="form-control" placeholder="Set up DeviceId"
                           value="@Model.Room.DeviceId">
                }
                else
                {
                    <input id="txt_searchLocation" name="txt_DeviceId" type="text" class="form-control" placeholder="Set up DeviceId">
                }
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="submit">Update</button>
                </div>
            </div>
        </div>
    </form>
    <br />
    <form class="container" method="post">
        <label>LCD Message</label>
        <input type="text" style="display:none;" value="updateDeviceMsg" name="postType" />
        <input type="text" style="display:none;" value="@Model.Room.DeviceId" name="txt_DeviceId" />
        <div class="row">
            <div class="input-group">
                <input id="txt_postMessage" name="txt_postMessage" type="text" class="form-control" placeholder="Post Message">
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="submit">Update</button>
                </div>
            </div>
        </div>
    </form>
}
<hr />
@if (Model.IsAdmin)
{
    <div id="confirmDelete" style="display:none;" class="alert alert-danger alert-dismissible" role="alert">
        <form method="post">
            <input type="text" style="display:none;" value="deleteRoom" name="postType" />
            <input type="text" style="display:none;" value="@Model.Room.Id" name="targetRoomId" />
            <button type="submit" class="btn btn-sm btn-outline-danger" style="margin:0px 3px 0px 3px;">I said delete!</button>
            <button type="button" onclick="btn_HangOn_OnClick();" class="btn btn-sm btn-outline-secondary" style="margin:0px 3px 0px 3px;">Hang on...</button>
            <strong>Delete this location?</strong> Are you sure??
        </form>
    </div>
}
<div id="pageLoader" class="container d-flex justify-content-center">
    <img src="~/images/Loader.gif" />
</div>
<div id="pageContent" class="container" style="display:none; min-width:560px;">
    @if (Model.ShowMessage)
    {
        <div class="alert @Model.Message.Split('|')[0] alert-dismissible fade show" role="alert">
            @Model.Message.Split('|')[1]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        Model.Message = "";
    }

    @if (!string.IsNullOrEmpty(Model.Room.DeviceId))
    {
        <br />
        <h4>Keycard Audits</h4>
        @for (int i = 0; i < Model.RfIdAudits.Length; i++)
        {
            string[] rfidAudit = Model.RfIdAudits[i];
            string id = "auditRecord" + i;
            <div class="card" style="display:none; width:100%; margin:10px 0px 10px 0px;" id="@id">
                <div class="card-body">
                    <h5 class="card-title">@rfidAudit[1]</h5>
                    <div class="card-text">
                        @rfidAudit[0]<br />
                        @rfidAudit[2]
                    </div>
                </div>
            </div>
        }
        @for (int i = 0; i < Model.RfIdAudits.Length; i++)
        {
            string id = "auditRecord" + i;
            <script>
                $("#@id").fadeIn(@Model.ContentFade);
            </script>
            Model.ContentFade += 10;
        }
        <hr />

        <br />
        <h4>Data Audits</h4>
        @for (int i = 0; i < Model.DataAudits.Length; i++)
        {
            string[] datumAudit = Model.DataAudits[i];
            string id = "dataRecord" + i;
            <div class="card" style="display:none; width:100%; margin:10px 0px 10px 0px;" id="@id">
                <div class="card-body">
                    <h5 class="card-title">@datumAudit[0]</h5>
                    <div class="card-text">
                        Humidity: @datumAudit[1]<br />
                        Temperature: @datumAudit[3]<br />
                        Lux Level: @datumAudit[2]
                    </div>
                </div>
            </div>
        }
        @for (int i = 0; i < Model.DataAudits.Length; i++)
        {
            string id = "dataRecord" + i;
            <script>
                $("#@id").fadeIn(@Model.ContentFade);
            </script>
            Model.ContentFade += 10;
        }
        <hr />
    }
    <br />
    <h4>Bookings</h4>
    <hr />
    @foreach (Booking booking in Model.Bookings)
    {
        <div class="card" style="display:none; width:100%; margin:10px 0px 10px 0px;" id="@booking.Id">
            <div class="card-body">
                <h5 class="card-title">@booking.BookedByName</h5>
                <div class="card-text">
                    Status: @booking.Status<br />
                    Time Slot: @booking.TimeSlot<br />
                    Supervised By: @booking.SupervisedByName<br />
                    @if (Model.IsAdmin)
                    {
                        <form method="post">
                            <input type="text" style="display:none;" value="deleteBooking" name="postType" />
                            <input type="text" style="display:none;" value="@booking.Id" name="targetBookingId" />
                            <button style="margin:0px 10px 0px 10px;" class="btn btn-outline-danger float-right">
                                Delete Booking
                            </button>
                        </form>
                    }
                </div>
            </div>
        </div>
    }
    @foreach (Booking booking in Model.Bookings)
    {
        <script>
                $("#@booking.Id").fadeIn(@Model.ContentFade);
        </script>
        Model.ContentFade += 10;
    }

    <script>
    $("#pageLoader").fadeOut(@Model.LoaderFade, function () {
        $(this).remove();
        $("#pageContent").fadeIn(@Model.ContentFade);
    });

    function btn_Delete_OnClick() {
        $("#confirmDelete").fadeIn(@Model.ContentFade);
    }
    function btn_HangOn_OnClick() {
        $("#confirmDelete").fadeOut(@Model.ContentFade);
    }
    </script>
</div>